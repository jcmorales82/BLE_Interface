<Window x:Class="BLE_Interface.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        xmlns:HelixToolkit="http://helix-toolkit.org/wpf"
        Title="BLE Interface" Height="1200" Width="1440"
        MinHeight="1000" MinWidth="1200">

    <Grid Background="#F5F5F5">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>  <!-- Control Buttons -->
            <RowDefinition Height="Auto"/>  <!-- Device List -->
            <RowDefinition Height="Auto"/>  <!-- System Logs -->
            <RowDefinition Height="*"/>     <!-- Data Display -->
        </Grid.RowDefinitions>
        
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="400"/>  <!-- Left Panel -->
            <ColumnDefinition Width="*"/>    <!-- Charts Area -->
        </Grid.ColumnDefinitions>

        <!-- Add a subtle separator between panels -->
        <Rectangle Grid.Row="0" Grid.RowSpan="4" Grid.Column="0" Grid.ColumnSpan="2"
                   Width="1" Fill="#CCCCCC" HorizontalAlignment="Right" Margin="0,10,0,10"/>

        <!-- Control Buttons Section -->
        <GroupBox Grid.Row="0" Grid.Column="0" Header="Device Controls" Margin="10,10,10,5">
            <StackPanel Margin="5">
                <!-- Control Buttons Row 1 -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                    <Button x:Name="btnScan" Content="Scan" Command="{Binding ScanCommand}" 
                            Width="80" Height="32" Margin="0,0,5,0" 
                            Background="#4CAF50" Foreground="White" BorderThickness="0"/>
                    <Button x:Name="btnConnect" Content="Connect" Command="{Binding ConnectCommand}" 
                            Width="80" Height="32" Margin="0,0,5,0"
                            Background="#2196F3" Foreground="White" BorderThickness="0"/>
                    <Button x:Name="btnSyncRTC" Content="Sync RTC" Command="{Binding SyncRTCCommand}" 
                            Width="80" Height="32" Margin="0,0,5,0"
                            Background="#FF9800" Foreground="White" BorderThickness="0"/>
                    <Button x:Name="btnHardwareInfo" Content="Hardware Info" Command="{Binding HardwareInfoCommand}" 
                            Width="100" Height="32" Margin="0,0,5,0"
                            Background="#9C27B0" Foreground="White" BorderThickness="0"/>
                </StackPanel>

                <!-- Control Buttons Row 2 -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                    <Button x:Name="btnStartActivity" Content="Start Activity" Command="{Binding StartActivityCommand}" 
                            Width="100" Height="32" Margin="0,0,5,0"
                            Background="#4CAF50" Foreground="White" BorderThickness="0"/>
                    <Button x:Name="btnStopActivity" Content="Stop Activity" Command="{Binding StopActivityCommand}" 
                            Width="100" Height="32" Margin="0,0,5,0"
                            Background="#F44336" Foreground="White" BorderThickness="0"/>
                    <Button Content="Factory Cal" Command="{Binding FactoryCalCommand}" 
                            Width="100" Height="32" Margin="0,0,5,0"
                            Background="#607D8B" Foreground="White" BorderThickness="0"/>
                </StackPanel>

                <!-- File Operations Buttons -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                    <Button x:Name="btnListFiles" Content="List Files" Command="{Binding ListFilesCommand}" 
                            Width="80" Height="32" Margin="0,0,5,0"
                            Background="#795548" Foreground="White" BorderThickness="0"/>
                    <Button x:Name="btnDownloadAll" Content="Download All" Command="{Binding DownloadAllCommand}" 
                            Width="100" Height="32" Margin="0,0,5,0"
                            Background="#3F51B5" Foreground="White" BorderThickness="0"/>
                    <Button x:Name="btnEraseFiles" Content="Erase Files" Command="{Binding EraseFilesCommand}" 
                            Width="100" Height="32" Margin="0,0,5,0"
                            Background="#E91E63" Foreground="White" BorderThickness="0"/>
        </StackPanel>

                <!-- Stretch Control Buttons -->
                <StackPanel Orientation="Horizontal">
                    <Button x:Name="btnStartStretch" Content="Start Stretch" Command="{Binding StartStretchCommand}" 
                            Width="100" Height="32" Margin="0,0,5,0"
                            Background="#00BCD4" Foreground="White" BorderThickness="0"/>
                    <Button x:Name="btnStopStretch" Content="Stop Stretch" Command="{Binding StopStretchCommand}" 
                            Width="100" Height="32" Margin="0,0,5,0"
                            Background="#FF5722" Foreground="White" BorderThickness="0"/>
                </StackPanel>
            </StackPanel>
        </GroupBox>



        <!-- Devices List -->
        <GroupBox Grid.Row="1" Grid.Column="0" Header="Available Devices" Margin="10,5,10,5">
            <ListBox x:Name="lbDevices" ItemsSource="{Binding Devices}" SelectedItem="{Binding SelectedDevice}"
                     Height="150" ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                     Background="White" BorderThickness="0">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Margin="5,3">
                            <TextBlock Text="{Binding Name}" FontWeight="Bold" MinWidth="120" 
                                       Foreground="#333333"/>
                            <TextBlock Text="{Binding Rssi}" Foreground="#666666" Margin="5,0,0,0"/>
                            <TextBlock Text=" dBm" Foreground="#666666"/>
                            <TextBlock Text="  •  " Foreground="#999999"/>
                            <TextBlock Foreground="#666666" 
                                       Text="{Binding BatteryPercent, TargetNullValue=Battery —, StringFormat=Battery {0}%}"/>
                        </StackPanel>
                    </DataTemplate>
                </ListBox.ItemTemplate>
                <ListBox.ItemContainerStyle>
                    <Style TargetType="ListBoxItem">
                        <Setter Property="Padding" Value="0"/>
                        <Setter Property="Margin" Value="0"/>
                        <Setter Property="Background" Value="Transparent"/>
                        <Style.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="#E3F2FD"/>
                                <Setter Property="Foreground" Value="#1976D2"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#F5F5F5"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </ListBox.ItemContainerStyle>
            </ListBox>
        </GroupBox>

        <!-- Log Display -->
        <GroupBox Grid.Row="2" Grid.Column="0" Header="System Logs" Margin="10,5,10,5">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto"
                              Background="White" BorderThickness="1" BorderBrush="#CCCCCC">
                    <TextBlock Text="{Binding LogMessages}" Foreground="#333333" FontSize="11" 
                               FontFamily="Consolas" TextWrapping="Wrap" Margin="5"/>
                </ScrollViewer>

                <Button Grid.Row="1" Content="Clear Logs" Command="{Binding ClearLogsCommand}"
                        Width="80" Height="25" HorizontalAlignment="Right" Margin="0,5,0,0"
                        Background="#F44336" Foreground="White" BorderThickness="0"/>
            </Grid>
        </GroupBox>

        <!-- Data Display Section -->
        <ScrollViewer Grid.Row="3" Grid.Column="0" VerticalScrollBarVisibility="Auto" Margin="10,5,10,10">
            <StackPanel>
                <!-- Live Metrics -->
                <GroupBox Header="Live Metrics" Margin="0,0,0,10">
                    <Grid Margin="5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="120"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Counter:" FontWeight="Bold" Margin="0,2"/>
                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding LatestCounter}" Margin="5,2"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Chest Raw:" FontWeight="Bold" Margin="0,2"/>
                        <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding LatestChestRaw}" Margin="5,2"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Chest Filtered:" FontWeight="Bold" Margin="0,2"/>
                        <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding LatestChestNormalized}" Margin="5,2"/>

                        <TextBlock Grid.Row="3" Grid.Column="0" Text="Accelerometer:" FontWeight="Bold" Margin="0,2"/>
                        <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding LatestAccelerometer}" Margin="5,2"/>

                        <TextBlock Grid.Row="4" Grid.Column="0" Text="Gyroscope:" FontWeight="Bold" Margin="0,2"/>
                        <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding LatestGyroscope}" Margin="5,2"/>

                        <TextBlock Grid.Row="5" Grid.Column="0" Text="Player Load:" FontWeight="Bold" Margin="0,2"/>
                        <TextBlock Grid.Row="5" Grid.Column="1" Text="{Binding LatestPlayerLoad}" Margin="5,2"/>

                        <TextBlock Grid.Row="6" Grid.Column="0" Text="Pressure:" FontWeight="Bold" Margin="0,2"/>
                        <TextBlock Grid.Row="6" Grid.Column="1" Text="{Binding LatestPressure}" Margin="5,2"/>

                        <TextBlock Grid.Row="7" Grid.Column="0" Text="Temperature:" FontWeight="Bold" Margin="0,2"/>
                        <TextBlock Grid.Row="7" Grid.Column="1" Text="{Binding LatestTemperature}" Margin="5,2"/>

                        <TextBlock Grid.Row="8" Grid.Column="0" Text="Stretch:" FontWeight="Bold" Margin="0,2"/>
                        <TextBlock Grid.Row="8" Grid.Column="1" Text="{Binding LatestStretch}" Margin="5,2"/>

                        <TextBlock Grid.Row="9" Grid.Column="0" Text="Heart Rate:" FontWeight="Bold" Margin="0,2"/>
                        <TextBlock Grid.Row="9" Grid.Column="1" Text="{Binding LatestHeartRate}" Margin="5,2"/>
                    </Grid>
                </GroupBox>

                <!-- Breathing Data -->
                <GroupBox Header="Breathing Data" Margin="0,0,0,10">
                    <Grid Margin="5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="120"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Counter:" FontWeight="Bold" Margin="0,2"/>
                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding LatestBreathCounter}" Margin="5,2"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Raw BR Interval:" FontWeight="Bold" Margin="0,2"/>
                        <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding LatestRawBRInterval}" Margin="5,2"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Proc BR Interval:" FontWeight="Bold" Margin="0,2"/>
                        <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding LatestProcessedBRInterval}" Margin="5,2"/>

                        <TextBlock Grid.Row="3" Grid.Column="0" Text="Raw Tidal Volume:" FontWeight="Bold" Margin="0,2"/>
                        <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding LatestRawTidalVolume}" Margin="5,2"/>

                        <TextBlock Grid.Row="4" Grid.Column="0" Text="Proc Tidal Volume:" FontWeight="Bold" Margin="0,2"/>
                        <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding LatestProcessedTidalVolume}" Margin="5,2"/>

                        <TextBlock Grid.Row="5" Grid.Column="0" Text="Raw Minute Volume:" FontWeight="Bold" Margin="0,2"/>
                        <TextBlock Grid.Row="5" Grid.Column="1" Text="{Binding LatestRawMinuteVolume}" Margin="5,2"/>

                        <TextBlock Grid.Row="6" Grid.Column="0" Text="Proc Minute Volume:" FontWeight="Bold" Margin="0,2"/>
                        <TextBlock Grid.Row="6" Grid.Column="1" Text="{Binding LatestProcessedMinuteVolume}" Margin="5,2"/>
                    </Grid>
                </GroupBox>

                <!-- Breath Timestamps -->
                <GroupBox Header="Breath Timestamps" Margin="0,0,0,10">
                    <Grid Margin="5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="120"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Counter:" FontWeight="Bold" Margin="0,2"/>
                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding LatestBreathTimestampsCounter}" Margin="5,2"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="TV Valley Time:" FontWeight="Bold" Margin="0,2"/>
                        <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding LatestTvValleyTimeIndex}" Margin="5,2"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="TV Valley Value:" FontWeight="Bold" Margin="0,2"/>
                        <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding LatestTvValleyValue}" Margin="5,2"/>

                        <TextBlock Grid.Row="3" Grid.Column="0" Text="TV Peak Time:" FontWeight="Bold" Margin="0,2"/>
                        <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding LatestTvPeakTimeIndex}" Margin="5,2"/>

                        <TextBlock Grid.Row="4" Grid.Column="0" Text="TV Peak Value:" FontWeight="Bold" Margin="0,2"/>
                        <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding LatestTvPeakValue}" Margin="5,2"/>
                    </Grid>
                </GroupBox>
            </StackPanel>
        </ScrollViewer>

        <!-- Charts Area -->
        <Grid Grid.Row="0" Grid.RowSpan="4" Grid.Column="1" Margin="10,10,10,10">
            <Grid.RowDefinitions>
                <RowDefinition Height="40*"/>  <!-- 40% - Breathing Metrics -->
                <RowDefinition Height="30*"/>  <!-- 30% - Chest Data -->
                <RowDefinition Height="30*"/>  <!-- 30% - IMU Data -->
            </Grid.RowDefinitions>
            
            <!-- Breathing Metrics Charts (40% height) -->
            <GroupBox Grid.Row="0" Header="Breathing Metrics" Margin="0,0,0,5">
                <Grid Margin="5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

        <!-- BR Chart -->
                    <Border Grid.Column="0" Margin="0,0,2,0" 
                BorderBrush="Gray" BorderThickness="1" Background="Black">
                        <Grid>
            <ContentControl Content="{Binding BRChart}"/>
                            <TextBlock Text="Breathing Rate (BR)" Foreground="White" 
                                      Margin="5" FontSize="12" FontWeight="Bold"/>
                        </Grid>
        </Border>

        <!-- TV Chart -->
                    <Border Grid.Column="1" Margin="2,0,2,0" 
                BorderBrush="Gray" BorderThickness="1" Background="Black">
                        <Grid>
            <ContentControl Content="{Binding TVChart}"/>
                            <TextBlock Text="Tidal Volume (TV)" Foreground="White" 
                                      Margin="5" FontSize="12" FontWeight="Bold"/>
                        </Grid>
        </Border>

        <!-- MV Chart -->
                    <Border Grid.Column="2" Margin="2,0,0,0" 
                BorderBrush="Gray" BorderThickness="1" Background="Black">
                        <Grid>
            <ContentControl Content="{Binding MVChart}"/>
                            <TextBlock Text="Minute Ventilation (MV)" Foreground="White" 
                                      Margin="5" FontSize="12" FontWeight="Bold"/>
            </Grid>
        </Border>
                </Grid>
            </GroupBox>
            
            <!-- Chest Data Charts (30% height) -->
            <GroupBox Grid.Row="1" Header="Chest Data" Margin="0,5,0,5">
                <Grid Margin="5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Chest Normalized Chart -->
                    <Border Grid.Column="0" Margin="0,0,2,0" 
                            BorderBrush="Gray" BorderThickness="1" Background="Black">
            <Grid>
                <ContentControl Content="{Binding ChestNormChart}"/>
                <TextBlock Text="Chest Normalized / Stretch" Foreground="Orange" 
                          Margin="5" FontSize="11" FontWeight="Bold"/>
            </Grid>
        </Border>

                    <!-- Chest Raw Chart -->
                    <Border Grid.Column="1" Margin="2,0,0,0" 
                BorderBrush="Gray" BorderThickness="1" Background="Black">
            <Grid>
                            <ContentControl Content="{Binding ChestRawChart}"/>
                            <TextBlock Text="Chest Raw" Foreground="Red" 
                                      Margin="5" FontSize="11" FontWeight="Bold"/>
            </Grid>
        </Border>
                </Grid>
            </GroupBox>
            
            <!-- IMU Data Charts (30% height) -->
            <GroupBox Grid.Row="2" Header="IMU Data" Margin="0,5,0,0">
                <Grid Margin="5">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Accelerometer Charts -->
                    <Border Grid.Row="0" Grid.Column="0" Margin="0,0,2,2" 
                            BorderBrush="Yellow" BorderThickness="1" Background="Black">
            <Grid>
                <ContentControl Content="{Binding AccXChart}"/>
                            <TextBlock Text="Acc X" Foreground="Yellow" 
                          Margin="5" FontSize="10" FontWeight="Bold"/>
            </Grid>
        </Border>

                    <Border Grid.Row="0" Grid.Column="1" Margin="2,0,2,2" 
                            BorderBrush="Cyan" BorderThickness="1" Background="Black">
            <Grid>
                <ContentControl Content="{Binding AccYChart}"/>
                            <TextBlock Text="Acc Y" Foreground="Cyan" 
                          Margin="5" FontSize="10" FontWeight="Bold"/>
            </Grid>
        </Border>

                    <Border Grid.Row="0" Grid.Column="2" Margin="2,0,0,2" 
                            BorderBrush="Red" BorderThickness="1" Background="Black">
            <Grid>
                <ContentControl Content="{Binding AccZChart}"/>
                            <TextBlock Text="Acc Z" Foreground="Red" 
                          Margin="5" FontSize="10" FontWeight="Bold"/>
            </Grid>
        </Border>

                    <!-- Gyroscope Charts -->
                    <Border Grid.Row="1" Grid.Column="0" Margin="0,2,2,0" 
                            BorderBrush="Yellow" BorderThickness="1" Background="Black">
            <Grid>
                <ContentControl Content="{Binding GyrXChart}"/>
                            <TextBlock Text="Gyr X" Foreground="Yellow" 
                          Margin="5" FontSize="10" FontWeight="Bold"/>
            </Grid>
        </Border>

                    <Border Grid.Row="1" Grid.Column="1" Margin="2,2,2,0" 
                            BorderBrush="Cyan" BorderThickness="1" Background="Black">
            <Grid>
                <ContentControl Content="{Binding GyrYChart}"/>
                            <TextBlock Text="Gyr Y" Foreground="Cyan" 
                          Margin="5" FontSize="10" FontWeight="Bold"/>
            </Grid>
        </Border>

                    <Border Grid.Row="1" Grid.Column="2" Margin="2,2,0,0" 
                            BorderBrush="Red" BorderThickness="1" Background="Black">
            <Grid>
                <ContentControl Content="{Binding GyrZChart}"/>
                            <TextBlock Text="Gyr Z" Foreground="Red" 
                          Margin="5" FontSize="10" FontWeight="Bold"/>
            </Grid>
        </Border>
                </Grid>
            </GroupBox>
            </Grid>

            </Grid>
</Window>